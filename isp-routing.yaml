proxies:
  - {name: 直连, type: direct}
  - {name: 拒绝, type: reject}

  - name: 移动
    type: direct
    ip-version: ipv6-prefer
    interface-name: pppoe-cmcc
    udp: true
    routing-mark: 1
    health-check:
      enable: true
      url: https://www.aliyun.com/favicon.ico
      interval: 5
      timeout: 2000
      lazy: false
    mptcp: true
#    tfo: true

  - name: 联通
    type: direct
    ip-version: ipv6-prefer
    interface-name: pppoe-cnc
    udp: true
    routing-mark: 2
    health-check:
      enable: true
      url: https://www.aliyun.com/favicon.ico
      interval: 5
      timeout: 2000
      lazy: false
    mptcp: true
#    tfo: true

  - name: 电信
    type: direct
    ip-version: ipv6-prefer
    interface-name: pppoe-ct
    udp: true
    routing-mark: 3
    health-check:
      enable: true
      url: https://www.aliyun.com/favicon.ico
      interval: 5
      timeout: 2000
      lazy: false
    mptcp: true
#    tfo: true

# ========================
# 主要端口设置
# ========================
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895

allow-lan: true
mode: rule
log-level: info

external-controller: 0.0.0.0:9090
# external-ui: ui
# external-ui-name: zashboard
# external-ui-url: https://gh-proxy.com/github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip
secret: "123456"

# ========================
# DNS 设置
# ========================
dns:
  enable: flase
  listen: 0.0.0.0:7874
  ipv6: true
  enhanced-mode: redir-host
  nameserver:
    - 223.5.5.5:53
    - 119.29.29.29:53
    - 223.6.6.6:53
    - 119.28.28.28:53

# ========================
# TUN 模块
# ========================
tun:
  enable: true
  stack: gvisor
  device: utun
  endpoint-independent-nat: true
  auto-route: false
  auto-detect-interface: false
  auto-redirect: false
  strict-route: false

profile:
  store-selected: true
  store-fake-ip: true
 

# ========================
# 策略组定义
# ========================

pr: &pr {type: select, proxies: [自动选择, 手动切换, 轮询, 拒绝]}
proxy-groups:
  - {name: 广告, <<: *pr}
  - {name: 其他, <<: *pr}

  - name: 自动选择
    type: url-test
    proxies:
    - 移动
    - 联通
    - 电信
    url: https://www.aliyun.com/favicon.ico
    interval: 5
    timeout: 2000
    max-failed-times: 5

  - name: 轮询
    type: load-balance
    strategy: round-robin
    proxies:
    - 移动
    - 联通
    - 电信
    url: https://www.aliyun.com/favicon.ico
    interval: 5
    timeout: 2000
    max-failed-times: 5
    
  - name: 手动切换
    type: select
    proxies:
    - 移动
    - 联通
    - 电信
    url: https://www.aliyun.com/favicon.ico
    interval: 5
    timeout: 2000
    max-failed-times: 5

# ========================
# 规则引擎（rules）
# ========================
rules:
  # 局域网直连
  - IP-CIDR,0.0.0.0/8,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,169.254.0.0/16,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.0.0.0/24,DIRECT
  - IP-CIDR,192.0.2.0/24,DIRECT
  - IP-CIDR,192.88.99.0/24,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,198.18.0.0/15,DIRECT
  - IP-CIDR,198.51.100.0/24,DIRECT
  - IP-CIDR,203.0.113.0/24,DIRECT
  - IP-CIDR,224.0.0.0/3,DIRECT
  - IP-CIDR6,::/127,DIRECT
  - IP-CIDR6,fc00::/7,DIRECT
  - IP-CIDR6,fe80::/10,DIRECT
  - IP-CIDR6,ff00::/8,DIRECT

  - RULE-SET,Advertising,广告
  - RULE-SET,sr_ad_only,广告
  - RULE-SET,广告,广告
  - RULE-SET,ad,广告

  - RULE-SET,中国移动v4,移动
  - RULE-SET,中国移动v6,移动
  - RULE-SET,中国联通v4,联通
  - RULE-SET,中国联通v6,联通
  - RULE-SET,中国电信v4,电信
  - RULE-SET,中国电信v6,电信
  # - RULE-SET,移动ASN,移动
  # - RULE-SET,联通ASN,联通
  # - RULE-SET,电信ASN,电信

  - MATCH,其他

# ========================
# 规则集提供者
# ========================
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  class: &class {type: http, interval: 86400, behavior: classical, format: text}
  iptxt: &iptxt {type: http, interval: 86400, behavior: ipcidr, format: text}

rule-providers:

  Advertising: { <<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Advertising/Advertising.list"}
  sr_ad_only: { <<: *class, url: "https://johnshall.github.io/Shadowrocket-ADBlock-Rules-Forever/sr_ad_only.conf"}
  广告: { <<: *domain, url: "https://raw.githubusercontent.com/GuangYu-yu/AdBlock_Rule_For_Clash/refs/heads/main/adblock_reject.mrs"}
  ad: { <<: *class, url: "https://raw.githubusercontent.com/LM-Firefly/Rules/refs/heads/master/Adblock/Adblock.list"}

  中国移动v4:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr/China_Mobile_v4.txt
    interval: 3600
    behavior: ipcidr
    format: text
    path: "./rule_provider/China_Mobile_v4.txt"
  中国移动v6:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr/China_Mobile_v6.txt
    interval: 3600
    behavior: ipcidr
    format: text
    path: "./rule_provider/China_Mobile_v6.txt"
  中国联通v4:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr/China_Unicom_v4.txt
    interval: 3600
    behavior: ipcidr
    format: text
    path: "./rule_provider/China_Unicom_v4.txt"
  中国联通v6:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr/China_Unicom_v6.txt
    interval: 3600
    behavior: ipcidr
    format: text
    path: "./rule_provider/China_Unicom_v6.txt"
  中国电信v4:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr/China_Telecom_v4.txt
    interval: 3600
    behavior: ipcidr
    format: text
    path: "./rule_provider/China_Telecom_v4.txt"
  中国电信v6:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr/China_Telecom_v6.txt
    interval: 3600
    behavior: ipcidr
    format: text
    path: "./rule_provider/China_Telecom_v6.txt"
  移动ASN:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr@main/Mobile_asn.yaml
    interval: 3600
    behavior: classical
    format: yaml
    path: "./rule_provider/Mobile_asn.yaml"
  联通ASN:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr@main/Unicom_asn.yaml
    interval: 3600
    behavior: classical
    format: yaml
    path: "./rule_provider/Unicom_asn.yaml"
  电信ASN:
    type: http
    url: https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr@main/Telecom_asn.yaml
    interval: 3600
    behavior: classical
    format: yaml
    path: "./rule_provider/Telecom_asn.yaml"

# OpenClash 设置
bind-address: "*"
external-ui: "/usr/share/openclash/ui"
external-ui-name: metacubexd
keep-alive-interval: 15
keep-alive-idle: 600
tcp-concurrent: true
unified-delay: true
geox-url:
  mmdb: https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb
  geosite: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat
  asn: https://testingcf.jsdelivr.net/gh/xishang0128/geoip@release/GeoLite2-ASN.mmdb
sniffer:
  enable: true
  override-destination: true
  sniff:
    QUIC:
      ports:
      - 443
    TLS:
      ports:
      - 443
      - 8443
    HTTP:
      ports:
      - 80
      - 8080-8880
      override-destination: true
  force-domain:
  - "+.netflix.com"
  - "+.nflxvideo.net"
  - "+.amazonaws.com"
  - "+.media.dssott.com"
  skip-domain:
  - "+.apple.com"
  - Mijia Cloud
  - dlg.io.mi.com
  - "+.oray.com"
  - "+.sunlogin.net"
  - "+.push.apple.com"
  parse-pure-ip: true
